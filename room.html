<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Tracker Application</title>
        <script type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script type="text/javascript">
            var socket = null;
	    function on_load()
	    {
		socket = io.connect("/");
            	/*Initializing the connection with the server via websockets */
            	socket.on("message",function(message) {
                	console.log("Message from the server arrived!")
                	parsed_message = JSON.parse(message);
			var id         = parsed_message.id;
			var x          = parsed_message.x;
			var y          = parsed_message.y;
			var width      = parsed_message.width;
			var height     = parsed_message.height;
			var staff_list = parsed_message.list;
			console.log(staff_list);
			create_detector(id, x, y, width, height, staff_list);
            	});
	    }

	    function create_detector(id, x, y, width, height, staff_list)
	    {
		console.log("Create detector:"+ id);
		var bold = document.createElement("b");
		bold.appendChild(document.createTextNode(staff_list));
		
		var old_element=document.getElementById(id);
		if (old_element) {
			if (document.getElementById(id).childNodes.length > 0 )
			{
				var child =  document.getElementById(id).children[0];
				// Remove div child
                		document.getElementById(id).removeChild(child);
				console.log("Replace text:" + staff_list +  old_element);
				old_element.appendChild(bold);
        		}
		} else {
			var  element = document.createElement("div");
			var style ="background:#98bf21;height:" + height + "px;width:" + width +  "px;left:" + x + "px;top:" + y + "px;position:absolute;opacity:0.4";
			element.setAttribute('style', style);
			element.setAttribute('id', id);
			element.appendChild(bold);
			document.getElementById("body").appendChild(element);
			console.log("Created first detector" + staff_list);
		}
	    }

	    function on_unload()
	    {
		console.log("Disconnect");
		if (socket != null) socket.disconnect();
	    }
        </script>
    </head>
    <body onload="on_load()" onunload="on_unload()">
	 <h1 style="color:blue;text-align:center;">
		Tracking Application
	 </h1>
	 <div id="body"style="background-image:url(/images/room.png);background-repeat: no-repeat; min-height:600px; min-width:600px; padding: 0%; background-position:center;">
	</div>
    </body>
</html>
